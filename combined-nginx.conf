server {
    listen 80;
    server_name 82.25.105.18;

    # Main landing page
    location = / {
        root /var/www/html;
        try_files /index.html =404;
    }

    # Sector-Heatmap (main heatmap dashboard)
    location = /Sector-Heatmap {
        return 301 /Sector-Heatmap/;
    }
    location /Sector-Heatmap/ {
        alias /home/heatmap-dashboard/frontend/dist/;
        index index.html;
        try_files $uri $uri/ /Sector-Heatmap/index.html;
    }

    # Multi-charts (proxy to service on port 8001)
    location /multi-charts/ {
        proxy_pass http://127.0.0.1:8001/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # RightTime (barline dashboard)
    location = /RightTime {
        return 301 /RightTime/;
    }
    location /RightTime/ {
        alias /var/www/barline/dist/;
        index index.html;
        try_files $uri $uri/ /RightTime/index.html;
    }

    # RightTime API proxy
    location /RightTime/api/ {
        proxy_pass http://127.0.0.1:8002/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # RightSector (right-sector dashboard)
    location = /RightSector {
        return 301 /RightSector/;
    }
    location /RightSector/ {
        alias /var/www/right-sector/;
        index dashboard.html;
        try_files $uri $uri/ /RightSector/dashboard.html;
    }

    # Heatmap API (for Sector-Heatmap backend)
    location /api/ {
        proxy_pass http://127.0.0.1:8000/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # Risk-Reward Application
    location /risk-reward/ {
        proxy_pass http://127.0.0.1:8003/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-Prefix /risk-reward;
        proxy_redirect off;
    }

    # Riskometer Application
    location /riskometer {
        alias /var/www/riskometer;
        try_files $uri $uri/ /riskometer/index.html;
    }

    location /riskometer/api/ {
        proxy_pass http://127.0.0.1:8006/api/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    location = /riskometer/ {
        proxy_pass http://127.0.0.1:8006/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
    }

    # Alphanifty Investment Platform API
    location /api/baskets/ {
        proxy_pass http://127.0.0.1:5000/api/baskets/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    location /api/health {
        proxy_pass http://127.0.0.1:5000/api/health;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
    }

    location /alphanifty/ {
        root /var/www/html/alphanifty_root;
        index index.html;
        try_files $uri $uri/ /alphanifty/index.html;
    }

    # Fundscreener Application
    location /pms-screener/ {
        proxy_pass http://127.0.0.1:8004/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Risk Return Analysis
    location /risk-return/ {
        alias /var/www/risk-return/frontend/build/;
        try_files $uri $uri/ /risk-return/index.html;
        index index.html;
    }
    
    location = /risk-return {
        return 301 /risk-return/;
    }

    location /risk-return/api/ {
        rewrite ^/risk-return/api/(.*) /api/$1 break;
        proxy_pass http://localhost:5002;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # Root level static files
    location ~ ^/[^/]+\.(png|jpg|jpeg|gif|svg|ico)$ {
        root /var/www/html;
        expires 30d;
    }
}
